{% extends "base.html" %}
{% block title %}Panel de Control{% endblock %}

{% block head_extra %}
<style>
    .panel-control-container {
        width: 100%;
        padding: 10px;
        box-sizing: border-box;
        max-height: calc(100vh - 70px);
        overflow-y: auto;
    }

    body.has-admin-nav .panel-control-container {
        max-height: calc(100vh - 140px);
    }

    .category-section {
        margin-top: 15px !important;
        margin-bottom: 10px !important;
    }

    .category-title {
        font-size: 1.2rem !important;
        padding: 10px 15px !important;
        margin-bottom: 10px !important;
    }

    .panel-header {
        display: none;
    }

    .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 10px;
        margin-bottom: 10px;
    }

    .info-card {
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        border: 2px solid rgba(102, 126, 234, 0.3);
        border-radius: 8px;
        padding: 12px;
        transition: all 0.3s ease;
    }

    .info-card:hover {
        transform: translateY(-2px);
        border-color: rgba(102, 126, 234, 0.6);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
    }

    .info-card .icon {
        font-size: 2rem;
        margin-bottom: 5px;
        display: block;
    }

    .info-card h3 {
        color: #e8e8e8;
        margin: 0 0 8px 0;
        font-size: 1rem;
        font-weight: bold;
    }

    .info-card p {
        color: #aaa;
        margin: 5px 0;
        font-size: 0.8rem;
        line-height: 1.4;
    }

    .info-card .badge {
        display: inline-block;
        margin-top: 5px;
        padding: 3px 8px;
        background: rgba(102, 126, 234, 0.2);
        border-radius: 15px;
        font-size: 0.7rem;
        color: #667eea;
    }

    .btn-config {
        padding: 10px 20px;
        background: rgba(102, 126, 234, 0.3);
        border: 1px solid rgba(102, 126, 234, 0.5);
        color: #667eea;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.95rem;
        font-weight: 600;
        width: 100%;
        margin-top: 15px;
        transition: all 0.3s ease;
    }

    .btn-config:hover {
        background: rgba(102, 126, 234, 0.5);
        border-color: rgba(102, 126, 234, 0.7);
        color: #fff;
    }

    .time-display {
        font-size: 1.5rem;
        color: #667eea;
        font-weight: bold;
        margin: 10px 0;
        font-family: 'Courier New', monospace;
    }

    .status-indicator {
        display: inline-block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 8px;
    }

    .status-online {
        background: #4caf50;
        box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
    }

    .status-offline {
        background: #f44336;
        box-shadow: 0 0 10px rgba(244, 67, 54, 0.5);
    }
</style>
{% endblock %}

{% block content %}
<div class="panel-control-container">
    <div class="info-grid">
        <!-- Informaci√≥n de Fecha y Hora (Compacta) -->
        <div class="info-card"
            style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%); border-color: rgba(102, 126, 234, 0.5); padding: 10px;">
            <span class="icon" style="font-size: 1.5rem; margin-bottom: 5px;">üïê</span>
            <h3 style="font-size: 0.9rem; margin: 0 0 5px 0;">Fecha y Hora</h3>
            <p class="time-display" id="current-time-display" style="font-size: 0.9rem; margin: 3px 0;">{{
                system_info.current_time }}</p>
            <p style="font-size: 0.7rem; color: #e8e8e8; margin: 2px 0;">
                <strong>{{ system_info.day_name }}</strong>, {{ system_info.current_date }}
            </p>
            <p style="font-size: 0.65rem; color: #aaa; margin: 2px 0;">
                {{ system_info.timezone }}
            </p>
            <span class="badge"
                style="background: rgba(102, 126, 234, 0.3); color: #667eea; font-size: 0.65rem; padding: 2px 6px; margin-top: 3px;">
                Tiempo real
            </span>
        </div>
        <!-- EQUIPO -->
        <div class="info-card" style="border-color: rgba(102, 126, 234, 0.5);">
            <span class="icon">üë•</span>
            <h3>EQUIPO</h3>
            <p style="font-size: 0.9rem; color: #aaa; margin: 10px 0;">
                Gestiona el equipo del sistema de forma local
            </p>
            <div style="margin-top: 15px;">
                <a href="{{ url_for('equipo.listar') }}" class="btn-config"
                    style="text-decoration: none; display: block; text-align: center;">
                    üë• Gestionar Equipo
                </a>
            </div>
            <span class="badge" style="background: rgba(102, 126, 234, 0.3); color: #667eea;">
                Gesti√≥n Local
            </span>
        </div>

        <!-- Gesti√≥n de Cargos -->
        <div class="info-card" style="border-color: rgba(156, 39, 176, 0.5);">
            <span class="icon">üëî</span>
            <h3>Gesti√≥n de Cargos</h3>
            <p style="font-size: 0.9rem; color: #aaa; margin: 10px 0;">
                Crea, edita o elimina los cargos disponibles para asignar a los miembros del equipo
            </p>
            <div style="margin-top: 15px;">
                <a href="{{ url_for('equipo.listar') }}#cargos-sueldos" class="btn-config"
                    style="text-decoration: none; display: block; text-align: center; background: rgba(156, 39, 176, 0.3); border-color: rgba(156, 39, 176, 0.5); color: #9c27b0;">
                    üëî Gestionar Cargos
                </a>
            </div>
            <span class="badge" style="background: rgba(156, 39, 176, 0.3); color: #9c27b0;">
                Configuraci√≥n
            </span>
        </div>

        <!-- Generar Pagos -->
        <div class="info-card" style="border-color: rgba(255, 193, 7, 0.5);">
            <span class="icon">üíµ</span>
            <h3>Generar Pagos</h3>
            <p style="font-size: 0.9rem; color: #aaa; margin: 10px 0;">
                Visualiza y gestiona todos los pagos pendientes agrupados por trabajador. Paga completo o realiza
                abonos.
            </p>
            <div style="margin-top: 15px;">
                <a href="{{ url_for('routes.admin_generar_pagos') }}" class="btn-config"
                    style="text-decoration: none; display: block; text-align: center; background: rgba(255, 193, 7, 0.3); border-color: rgba(255, 193, 7, 0.5); color: #ffc107;">
                    üíµ Generar Pagos
                </a>
            </div>
            <span class="badge" style="background: rgba(255, 193, 7, 0.3); color: #ffc107;">
                Gesti√≥n de Pagos
            </span>
        </div>

        <!-- Actualizar Sitio en Producci√≥n -->
        <div class="info-card" style="border-color: rgba(76, 175, 80, 0.5);">
            <span class="icon">üöÄ</span>
            <h3>Actualizar Sitio</h3>
            <p style="font-size: 0.9rem; color: #aaa; margin: 10px 0;">
                Despliega los √∫ltimos cambios a producci√≥n (stvaldivia.cl). Esto actualiza el sitio en vivo.
            </p>
            <div style="margin-top: 15px;">
                <button onclick="deployToProduction()" id="deploy-btn" class="btn-config"
                    style="text-decoration: none; display: block; text-align: center; background: rgba(76, 175, 80, 0.3); border-color: rgba(76, 175, 80, 0.5); color: #4caf50;">
                    üöÄ Actualizar Sitio
                </button>
            </div>
            <div id="deploy-status"
                style="display: none; margin-top: 10px; padding: 10px; border-radius: 8px; font-size: 0.85rem;"></div>
            <span class="badge" style="background: rgba(76, 175, 80, 0.3); color: #4caf50;">
                Deployment
            </span>
        </div>

        <!-- Control de Servicios Externos -->
        <div class="info-card" style="border-color: rgba(156, 39, 176, 0.5); grid-column: 1 / -1;">
            <span class="icon">üîß</span>
            <h3>Control de Servicios Externos</h3>
            <p style="font-size: 0.9rem; color: #aaa; margin: 10px 0;">
                Activa o desactiva las conexiones a servicios externos. En modo local, todos los servicios est√°n
                desactivados.
            </p>

            <div
                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-top: 20px;">
                <!-- OpenAI -->
                <div
                    style="background: rgba(26, 26, 46, 0.5); border: 1px solid rgba(102, 126, 234, 0.3); border-radius: 10px; padding: 15px;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <h4 style="color: #e8e8e8; margin: 0; font-size: 1.1rem;">ü§ñ OpenAI</h4>
                        <span id="openai-service-status" class="status-indicator status-offline"></span>
                    </div>
                    <p style="font-size: 0.85rem; color: #aaa; margin: 5px 0;">
                        Agente virtual para redes sociales
                    </p>
                    <div style="display: flex; gap: 8px; margin-top: 10px; flex-wrap: wrap;">
                        <button onclick="openServiceConfig('openai')" class="btn-config"
                            style="padding: 8px 12px; font-size: 0.9rem; background: rgba(255, 152, 0, 0.3); border-color: rgba(255, 152, 0, 0.5); color: #ff9800;">
                            ‚öôÔ∏è Configurar
                        </button>
                        <button onclick="toggleService('openai')" id="toggle-openai-btn" class="btn-config"
                            style="flex: 1; padding: 8px; font-size: 0.9rem; min-width: 100px;">
                            üü¢ Activar
                        </button>
                        <button onclick="toggleServiceLog('openai')" class="btn-config"
                            style="padding: 8px 12px; font-size: 0.9rem; background: rgba(102, 126, 234, 0.3); border-color: rgba(102, 126, 234, 0.5); color: #667eea;">
                            üìã Log
                        </button>
                    </div>
                    <!-- Colapso de logs para OpenAI -->
                    <div id="openai-log-collapse"
                        style="display: none; margin-top: 15px; padding: 15px; background: rgba(26, 26, 46, 0.8); border-radius: 8px; border: 1px solid rgba(102, 126, 234, 0.3);">
                        <div id="openai-log-content" style="min-height: 100px;">
                            <div style="text-align: center; padding: 20px; color: #aaa;">‚è≥ Cargando logs...</div>
                        </div>
                    </div>
                </div>

                <!-- GetNet -->
                <div
                    style="background: rgba(26, 26, 46, 0.5); border: 1px solid rgba(102, 126, 234, 0.3); border-radius: 10px; padding: 15px;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <h4 style="color: #e8e8e8; margin: 0; font-size: 1.1rem;">üí≥ GetNet</h4>
                        <span id="getnet-service-status" class="status-indicator status-offline"></span>
                    </div>
                    <p style="font-size: 0.85rem; color: #aaa; margin: 5px 0;">
                        Integraci√≥n de pagos POS
                    </p>
                    <div style="display: flex; gap: 8px; margin-top: 10px; flex-wrap: wrap;">
                        <button onclick="openServiceConfig('getnet')" class="btn-config"
                            style="padding: 8px 12px; font-size: 0.9rem; background: rgba(255, 152, 0, 0.3); border-color: rgba(255, 152, 0, 0.5); color: #ff9800;">
                            ‚öôÔ∏è Configurar
                        </button>
                        <button onclick="toggleService('getnet')" id="toggle-getnet-btn" class="btn-config"
                            style="flex: 1; padding: 8px; font-size: 0.9rem; min-width: 100px;">
                            üü¢ Activar
                        </button>
                        <button onclick="toggleServiceLog('getnet')" class="btn-config"
                            style="padding: 8px 12px; font-size: 0.9rem; background: rgba(102, 126, 234, 0.3); border-color: rgba(102, 126, 234, 0.5); color: #667eea;">
                            üìã Log
                        </button>
                    </div>
                    <!-- Colapso de logs para GetNet -->
                    <div id="getnet-log-collapse"
                        style="display: none; margin-top: 15px; padding: 15px; background: rgba(26, 26, 46, 0.8); border-radius: 8px; border: 1px solid rgba(102, 126, 234, 0.3);">
                        <div id="getnet-log-content" style="min-height: 100px;">
                            <div style="text-align: center; padding: 20px; color: #aaa;">‚è≥ Cargando logs...</div>
                        </div>
                    </div>
                </div>

                <!-- SumUp -->
                <div
                    style="background: rgba(26, 26, 46, 0.5); border: 1px solid rgba(102, 126, 234, 0.3); border-radius: 10px; padding: 15px;">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                        <h4 style="color: #e8e8e8; margin: 0; font-size: 1.1rem;">üì± SumUp</h4>
                        <span id="sumup-service-status" class="status-indicator status-offline"></span>
                    </div>
                    <p style="font-size: 0.85rem; color: #aaa; margin: 5px 0;">
                        Integraci√≥n de pagos m√≥viles
                    </p>
                    <div style="display: flex; gap: 8px; margin-top: 10px; flex-wrap: wrap;">
                        <button onclick="openServiceConfig('sumup')" class="btn-config"
                            style="padding: 8px 12px; font-size: 0.9rem; background: rgba(255, 152, 0, 0.3); border-color: rgba(255, 152, 0, 0.5); color: #ff9800;">
                            ‚öôÔ∏è Configurar
                        </button>
                        <button onclick="toggleService('sumup')" id="toggle-sumup-btn" class="btn-config"
                            style="flex: 1; padding: 8px; font-size: 0.9rem; min-width: 100px;">
                            üü¢ Activar
                        </button>
                        <button onclick="toggleServiceLog('sumup')" class="btn-config"
                            style="padding: 8px 12px; font-size: 0.9rem; background: rgba(102, 126, 234, 0.3); border-color: rgba(102, 126, 234, 0.5); color: #667eea;">
                            üìã Log
                        </button>
                    </div>
                    <!-- Colapso de logs para SumUp -->
                    <div id="sumup-log-collapse"
                        style="display: none; margin-top: 15px; padding: 15px; background: rgba(26, 26, 46, 0.8); border-radius: 8px; border: 1px solid rgba(102, 126, 234, 0.3);">
                        <div id="sumup-log-content" style="min-height: 100px;">
                            <div style="text-align: center; padding: 20px; color: #aaa;">‚è≥ Cargando logs...</div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="services-toggle-message"
                style="display: none; margin-top: 15px; padding: 10px; border-radius: 8px; font-size: 0.9rem;"></div>

            <span class="badge"
                style="background: rgba(156, 39, 176, 0.3); color: #9c27b0; margin-top: 15px; display: block;">
                Configuraci√≥n de Servicios
            </span>
        </div>

        <!-- Modal para Gestionar Equipo -->
        <div id="employees-modal"
            style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); z-index: 10000; align-items: center; justify-content: center; overflow-y: auto; box-sizing: border-box;">
            <div
                style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border: 2px solid rgba(102, 126, 234, 0.5); border-radius: 15px; padding: 30px; max-width: 900px; width: 90%; max-height: 90vh; margin: 20px auto; box-sizing: border-box; overflow-y: auto;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="color: #e8e8e8; margin: 0;">üë• Gesti√≥n de Equipo</h2>
                    <button onclick="closeEmployeesModal()"
                        style="background: rgba(244, 67, 54, 0.3); border: 1px solid rgba(244, 67, 54, 0.5); color: #f44336; border-radius: 5px; padding: 8px 16px; cursor: pointer; font-size: 1.2rem; line-height: 1;">
                        ‚úï
                    </button>
                </div>
                <!-- Estad√≠sticas del equipo -->
                <div id="employees-stats"
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px;">
                    <div
                        style="background: rgba(102, 126, 234, 0.2); border: 1px solid rgba(102, 126, 234, 0.3); border-radius: 10px; padding: 15px; text-align: center;">
                        <div style="font-size: 2rem; margin-bottom: 5px;">üë•</div>
                        <div style="font-size: 1.5rem; font-weight: bold; color: #667eea;" id="total-employees">-</div>
                        <div style="font-size: 0.85rem; color: #aaa;">Total</div>
                    </div>
                    <div
                        style="background: rgba(76, 175, 80, 0.2); border: 1px solid rgba(76, 175, 80, 0.3); border-radius: 10px; padding: 15px; text-align: center;">
                        <div style="font-size: 2rem; margin-bottom: 5px;">‚úÖ</div>
                        <div style="font-size: 1.5rem; font-weight: bold; color: #4caf50;" id="active-employees">-</div>
                        <div style="font-size: 0.85rem; color: #aaa;">Activos</div>
                    </div>
                    <div
                        style="background: rgba(255, 152, 0, 0.2); border: 1px solid rgba(255, 152, 0, 0.3); border-radius: 10px; padding: 15px; text-align: center;">
                        <div style="font-size: 2rem; margin-bottom: 5px;">‚ùå</div>
                        <div style="font-size: 1.5rem; font-weight: bold; color: #ff9800;" id="inactive-employees">-
                        </div>
                        <div style="font-size: 0.85rem; color: #aaa;">Inactivos</div>

                        <!-- Barra de b√∫squeda y filtros -->
                        <div
                            style="margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
                            <div style="flex: 1; min-width: 200px;">
                                <input type="text" id="employee-search" placeholder="üîç Buscar por nombre o cargo..."
                                    style="width: 100%; padding: 10px; background: rgba(26, 26, 46, 0.5); border: 1px solid rgba(102, 126, 234, 0.3); border-radius: 8px; color: #e8e8e8; font-size: 0.95rem;"
                                    onkeyup="filterEmployees()">
                            </div>
                            <select id="employee-filter-cargo" onchange="filterEmployees()"
                                style="padding: 10px; background: rgba(26, 26, 46, 0.5); border: 1px solid rgba(102, 126, 234, 0.3); border-radius: 8px; color: #e8e8e8; font-size: 0.95rem; cursor: pointer;">
                                <option value="">Todos los cargos</option>
                                <option value="BARRA">BARRA</option>
                                <option value="CAJA">CAJA</option>
                                <option value="GUARDIA">GUARDIA</option>
                                <option value="ANFITRIONA">ANFITRIONA</option>
                                <option value="ASEO">ASEO</option>
                                <option value="GUARDARROP">GUARDARROP</option>
                                <option value="T√âCNICA">T√âCNICA</option>
                                <option value="DRAG">DRAG</option>
                                <option value="DJ">DJ</option>
                            </select>
                            <select id="employee-filter-status" onchange="filterEmployees()"
                                style="padding: 10px; background: rgba(26, 26, 46, 0.5); border: 1px solid rgba(102, 126, 234, 0.3); border-radius: 8px; color: #e8e8e8; font-size: 0.95rem; cursor: pointer;">
                                <option value="">Todos</option>
                                <option value="active">Solo activos</option>
                                <option value="inactive">Solo inactivos</option>
                            </select>
                            <button onclick="openAddEmployeeForm()"
                                style="padding: 10px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; color: white; border-radius: 8px; cursor: pointer; font-weight: 600; white-space: nowrap;">
                                ‚ûï Agregar
                            </button>
                        </div>
                        <div id="employees-list" style="max-height: 500px; overflow-y: auto;">
                            <p style="text-align: center; color: #aaa; padding: 20px;">Cargando equipo...</p>
                        </div>
                        <div id="add-employee-form"
                            style="display: none; margin-top: 20px; padding: 20px; background: rgba(26, 26, 46, 0.5); border-radius: 10px; border: 1px solid rgba(102, 126, 234, 0.3); box-sizing: border-box; position: relative; z-index: 1;">
                            <h3 style="color: #e8e8e8; margin-top: 0;">Agregar/Editar Miembro del Equipo</h3>
                            <form id="employee-form" onsubmit="saveEmployee(event)">
                                <input type="hidden" id="employee-id" name="employee_id">

                                <div style="margin-bottom: 15px;">
                                    <label
                                        style="display: block; color: #e8e8e8; margin-bottom: 8px; font-weight: 600;">
                                        Nombre:
                                    </label>
                                    <input type="text" id="employee-name" name="name" required
                                        style="width: 100%; padding: 10px; background: rgba(26, 26, 46, 0.5); border: 1px solid rgba(102, 126, 234, 0.3); border-radius: 8px; color: #e8e8e8; font-size: 0.95rem;"
                                        placeholder="Nombre completo">
                                </div>
                                <div style="margin-bottom: 15px;">
                                    <label
                                        style="display: block; color: #e8e8e8; margin-bottom: 8px; font-weight: 600;">
                                        Cargo:
                                    </label>
                                    <select id="employee-cargo" name="cargo" required
                                        style="width: 100%; padding: 10px; background: rgba(26, 26, 46, 0.5); border: 1px solid rgba(102, 126, 234, 0.3); border-radius: 8px; color: #e8e8e8; font-size: 0.95rem;">
                                        <option value="">Seleccionar cargo...</option>
                                        <optgroup label="Barra">
                                            <option value="BARRA">BARRA</option>
                                        </optgroup>
                                        <optgroup label="Coperx">
                                            <option value="COPERX 1">COPERX 1</option>
                                        </optgroup>
                                        <optgroup label="Caja">
                                            <option value="CAJA 1">CAJA 1</option>
                                            <option value="CAJA 2">CAJA 2</option>
                                            <option value="CAJA 3">CAJA 3</option>
                                        </optgroup>
                                        <optgroup label="Guardia">
                                            <option value="GUARDIA 1">GUARDIA 1</option>
                                            <option value="GUARDIA 2">GUARDIA 2</option>
                                            <option value="GUARDIA 3">GUARDIA 3</option>
                                        </optgroup>
                                        <optgroup label="Servicio">
                                            <option value="ANFITRIONA">ANFITRIONA</option>
                                            <option value="ASEO">ASEO</option>
                                            <option value="GUARDARROP">GUARDARROP</option>
                                        </optgroup>
                                        <optgroup label="T√©cnica">
                                            <option value="T√âCNICA">T√âCNICA</option>
                                        </optgroup>
                                        <optgroup label="Artistas">
                                            <option value="DRAG">DRAG</option>
                                            <option value="DJ 1">DJ 1</option>
                                            <option value="DJ 2">DJ 2</option>
                                        </optgroup>
                                        <optgroup label="Otros">
                                            <option value="Supervisor">Supervisor</option>
                                            <option value="Administrador">Administrador</option>
                                            <option value="Otro">Otro</option>
                                        </optgroup>
                                    </select>
                                </div>
                                <div style="margin-bottom: 15px;">
                                    <label
                                        style="display: block; color: #e8e8e8; margin-bottom: 8px; font-weight: 600;">
                                        PIN (4 d√≠gitos):
                                    </label>
                                    <input type="text" id="employee-pin" name="pin" maxlength="4" pattern="[0-9]{4}"
                                        style="width: 100%; padding: 10px; background: rgba(26, 26, 46, 0.5); border: 1px solid rgba(102, 126, 234, 0.3); border-radius: 8px; color: #e8e8e8; font-size: 0.95rem; font-family: monospace;"
                                        placeholder="1234">
                                    <p style="font-size: 0.85rem; color: #aaa; margin-top: 5px;">
                                        PIN num√©rico de 4 d√≠gitos para autenticaci√≥n
                                    </p>
                                </div>
                                <div style="margin-bottom: 15px;">
                                    <label
                                        style="display: block; color: #e8e8e8; margin-bottom: 8px; font-weight: 600;">
                                        Activo:
                                    </label>
                                    <label style="display: flex; align-items: center; cursor: pointer;">
                                        <input type="checkbox" id="employee-active" name="active" checked
                                            style="margin-right: 10px; width: 20px; height: 20px; cursor: pointer;">
                                        <span style="color: #e8e8e8;">Miembro activo en el sistema</span>
                                    </label>
                                </div>
                                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                                    <button type="button" onclick="cancelEmployeeForm()"
                                        style="padding: 10px 20px; background: rgba(102, 126, 234, 0.2); border: 1px solid rgba(102, 126, 234, 0.5); color: #667eea; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                        Cancelar
                                    </button>
                                    <button type="submit"
                                        style="padding: 10px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; color: white; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                        üíæ Guardar
                                    </button>
                                </div>
                            </form>
                        </div>
                        <script>
                            // Actualizar hora en tiempo real
                            function updateCurrentTime() {
                                const now = new Date();
                                const hours = String(now.getHours()).padStart(2, '0');
                                const minutes = String(now.getMinutes()).padStart(2, '0');
                                const seconds = String(now.getSeconds()).padStart(2, '0');
                                const timeElement = document.getElementById('current-time-display');
                                if (timeElement) {
                                    timeElement.textContent = `${hours}:${minutes}:${seconds}`;
                                }
                            }

                            // Actualizar cada segundo
                            updateCurrentTime();
                            setInterval(updateCurrentTime, 1000);

                            // Funciones para el modal de configuraci√≥n de API
                            function openApiConfigModal() {
                                const modal = document.getElementById('api-config-modal');
                                if (modal) {
                                    modal.style.display = 'flex';
                                }
                            }

                            function closeApiConfigModal() {
                                const modal = document.getElementById('api-config-modal');
                                if (modal) {
                                    modal.style.display = 'none';
                                }
                                // Limpiar mensajes
                                const messageDiv = document.getElementById('api-config-message');
                                if (messageDiv) {
                                    messageDiv.style.display = 'none';
                                    messageDiv.textContent = '';
                                }
                            }

                            function saveApiConfig(event) {
                                event.preventDefault();

                                const form = event.target;
                                const apiUrl = document.getElementById('api-url-input').value.trim();
                                const apiKey = document.getElementById('api-key-input').value.trim();
                                const messageDiv = document.getElementById('api-config-message');
                                const submitBtn = form.querySelector('button[type="submit"]');

                                // Validar
                                if (!apiUrl || !apiKey) {
                                    messageDiv.style.display = 'block';
                                    messageDiv.style.background = 'rgba(244, 67, 54, 0.2)';
                                    messageDiv.style.border = '1px solid rgba(244, 67, 54, 0.5)';
                                    messageDiv.style.color = '#f44336';
                                    messageDiv.textContent = '‚ùå Por favor, completa todos los campos';
                                    return;
                                }

                                // Mostrar loading
                                const originalText = submitBtn.textContent;
                                submitBtn.textContent = '‚è≥ Guardando...';
                                submitBtn.disabled = true;

                                // Enviar datos
                                fetch('/admin/api/update-config', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json',
                                    },
                                    body: JSON.stringify({
                                        api_url: apiUrl,
                                        api_key: apiKey
                                    })
                                })
                                    .then(response => response.json())
                                    .then(data => {
                                        if (data.success) {
                                            messageDiv.style.display = 'block';
                                            messageDiv.style.background = 'rgba(76, 175, 80, 0.2)';
                                            messageDiv.style.border = '1px solid rgba(76, 175, 80, 0.5)';
                                            messageDiv.style.color = '#4caf50';
                                            messageDiv.textContent = '‚úÖ Configuraci√≥n guardada correctamente. La aplicaci√≥n se reiniciar√° en unos segundos...';

                                            // Actualizar display
                                            const urlDisplay = document.getElementById('api-url-display');
                                            if (urlDisplay) {
                                                urlDisplay.textContent = apiUrl;
                                            }

                                            // Cerrar modal despu√©s de 2 segundos
                                            setTimeout(() => {
                                                closeApiConfigModal();
                                                // Recargar p√°gina despu√©s de 3 segundos para aplicar cambios
                                                setTimeout(() => {
                                                    window.location.reload();
                                                }, 3000);
                                            }, 2000);
                                        } else {
                                            messageDiv.style.display = 'block';
                                            messageDiv.style.background = 'rgba(244, 67, 54, 0.2)';
                                            messageDiv.style.border = '1px solid rgba(244, 67, 54, 0.5)';
                                            messageDiv.style.color = '#f44336';
                                            messageDiv.textContent = `‚ùå Error: ${data.message || 'No se pudo guardar la configuraci√≥n'}`;
                                            submitBtn.textContent = originalText;
                                            submitBtn.disabled = false;
                                        }
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                        messageDiv.style.display = 'block';
                                        messageDiv.style.background = 'rgba(244, 67, 54, 0.2)';
                                        messageDiv.style.border = '1px solid rgba(244, 67, 54, 0.5)';
                                        messageDiv.style.color = '#f44336';
                                        messageDiv.textContent = '‚ùå Error de conexi√≥n. Por favor, intenta nuevamente.';
                                        submitBtn.textContent = originalText;
                                        submitBtn.disabled = false;
                                    });
                            }

                            // Cerrar modal al hacer clic fuera
                            document.addEventListener('click', function (event) {
                                const modal = document.getElementById('api-config-modal');
                                if (modal && event.target === modal) {
                                    closeApiConfigModal();
                                }
                            });

                            // Actualizar estado de API peri√≥dicamente
                            function refreshApiStatus() {
                                fetch('/api/services/status')
                                    .then(response => response.json())
                                    .then(data => {
                                        if (data.success) {
                                            const apiStatus = data;

                                            // Recargar logs despu√©s de verificar
                                            loadApiLogs();

                                            // Actualizar indicador de estado (c√≠rculo)
                                            const statusIndicator = document.querySelector('.status-indicator');
                                            if (statusIndicator) {
                                                if (apiStatus.online) {
                                                    statusIndicator.classList.remove('status-offline');
                                                    statusIndicator.classList.add('status-online');
                                                } else {
                                                    statusIndicator.classList.remove('status-online');
                                                    statusIndicator.classList.add('status-offline');
                                                }
                                            }

                                            // Actualizar texto del estado (Conectada/Desconectada)
                                            const statusLabel = document.getElementById('api-status-label');
                                            const statusText = document.getElementById('api-status-text');
                                            if (statusLabel) {
                                                statusLabel.textContent = apiStatus.online ? 'Conectada' : 'Desconectada';
                                            }
                                            if (statusText) {
                                                statusText.style.color = apiStatus.online ? '#4caf50' : '#f44336';
                                            }

                                            // Actualizar tiempo de respuesta
                                            const responseTimeElement = document.getElementById('api-response-time');
                                            const responseTimeContainer = document.getElementById('api-response-time-container');
                                            if (responseTimeElement && responseTimeContainer) {
                                                if (apiStatus.online && apiStatus.response_time_ms) {
                                                    responseTimeElement.textContent = Math.round(apiStatus.response_time_ms);
                                                    responseTimeContainer.style.display = 'block';
                                                } else {
                                                    responseTimeContainer.style.display = 'none';
                                                }
                                            }

                                            // Actualizar mensaje de error si est√° offline
                                            const errorMessage = document.getElementById('api-error-message');
                                            if (errorMessage) {
                                                if (!apiStatus.online) {
                                                    errorMessage.textContent = apiStatus.message || 'API desconectada';
                                                    errorMessage.style.display = 'block';
                                                } else {
                                                    errorMessage.style.display = 'none';
                                                }
                                            }

                                            // Actualizar badge
                                            const badge = document.querySelector('.info-card .badge');
                                            if (badge && badge.closest('.info-card').querySelector('.icon').textContent.includes('üîå')) {
                                                badge.textContent = apiStatus.online ? 'Online' : 'Offline';
                                                badge.style.background = apiStatus.online ? 'rgba(76, 175, 80, 0.3)' : 'rgba(244, 67, 54, 0.3)';
                                                badge.style.color = apiStatus.online ? '#4caf50' : '#f44336';
                                            }

                                            // Actualizar borde de la tarjeta de API
                                            const apiCard = Array.from(document.querySelectorAll('.info-card')).find(card =>
                                                card.querySelector('.icon') && card.querySelector('.icon').textContent.includes('üîå')
                                            );
                                            if (apiCard) {
                                                apiCard.style.borderColor = apiStatus.online ? 'rgba(76, 175, 80, 0.5)' : 'rgba(244, 67, 54, 0.5)';
                                            }
                                        }
                                    })
                                    .catch(error => {
                                        console.error('Error al actualizar estado de API:', error);
                                    });
                            }

                            // Funci√≥n para cargar el log de conexiones API
                            function loadApiLogs() {
                                const container = document.getElementById('api-logs-container');
                                if (!container) return;

                                container.innerHTML = '<div style="text-align: center; color: #888; padding: 20px;">Cargando...</div>';

                                fetch('/admin/api/connection-logs')
                                    .then(response => response.json())
                                    .then(data => {
                                        if (!data || !data.success) {
                                            modalContent.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #f44336;">
                        <p style="font-size: 1.2rem; margin-bottom: 10px;">‚ùå</p>
                        <p>Error al obtener los logs del servicio.</p>
                        <p style="font-size: 0.85rem; margin-top: 10px;">${data?.message || 'Error desconocido'}</p>
                    </div>
                `;
                                            return;
                                        }

                                        if (data.logs && data.logs.length > 0) {
                                            let html = '<table style="width: 100%; border-collapse: collapse; font-size: 0.85rem;">';
                                            html += '<thead><tr style="border-bottom: 1px solid rgba(102, 126, 234, 0.3);">';
                                            html += '<th style="padding: 8px; text-align: left; color: #667eea;">Fecha/Hora</th>';
                                            html += '<th style="padding: 8px; text-align: left; color: #667eea;">Estado</th>';
                                            html += '<th style="padding: 8px; text-align: left; color: #667eea;">Tiempo (ms)</th>';
                                            html += '<th style="padding: 8px; text-align: left; color: #667eea;">Origen</th>';
                                            html += '<th style="padding: 8px; text-align: left; color: #667eea;">Mensaje</th>';
                                            html += '</tr></thead><tbody>';

                                            data.logs.forEach(log => {
                                                const statusColor = log.status === 'online' ? '#4caf50' : (log.status === 'offline' ? '#f44336' : '#ff9800');
                                                const statusIcon = log.status === 'online' ? '‚úÖ' : (log.status === 'offline' ? '‚ùå' : '‚ö†Ô∏è');
                                                const checkedByText = log.checked_by === 'admin' ? 'üë§ Admin' : (log.checked_by === 'manual' ? 'üîç Manual' : 'ü§ñ Sistema');

                                                html += '<tr style="border-bottom: 1px solid rgba(102, 126, 234, 0.1);">';
                                                html += `<td style="padding: 8px; color: #aaa;">${log.timestamp}</td>`;
                                                html += `<td style="padding: 8px; color: ${statusColor}; font-weight: bold;">${statusIcon} ${log.status.toUpperCase()}</td>`;
                                                html += `<td style="padding: 8px; color: #aaa;">${log.response_time_ms ? Math.round(log.response_time_ms) + 'ms' : 'N/A'}</td>`;
                                                html += `<td style="padding: 8px; color: #aaa;">${checkedByText}</td>`;
                                                html += `<td style="padding: 8px; color: #888; font-size: 0.8rem;">${log.message || 'N/A'}</td>`;
                                                html += '</tr>';
                                            });

                                            html += '</tbody></table>';
                                            container.innerHTML = html;
                                        } else {
                                            container.innerHTML = '<div style="text-align: center; color: #888; padding: 20px;">No hay registros de conexi√≥n a√∫n</div>';
                                        }
                                    })
                                    .catch(error => {
                                        console.error('Error al cargar logs:', error);
                                        container.innerHTML = '<div style="text-align: center; color: #f44336; padding: 20px;">Error al cargar el log de conexiones</div>';
                                    });
                            }

                            // El log solo se carga al presionar el bot√≥n "Actualizar"

                            // Funci√≥n para comprobar conexi√≥n manualmente
                            function checkApiConnection() {
                                const checkBtn = document.getElementById('check-connection-btn');
                                const resultDiv = document.getElementById('connection-check-result');

                                if (!checkBtn || !resultDiv) return;

                                // Deshabilitar bot√≥n y mostrar loading
                                const originalText = checkBtn.textContent;
                                checkBtn.disabled = true;
                                checkBtn.textContent = '‚è≥ Comprobando...';
                                checkBtn.style.opacity = '0.6';
                                resultDiv.style.display = 'none';

                                // Llamar al endpoint de verificaci√≥n manual
                                fetch('/admin/api/check-connection', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json'
                                    }
                                })
                                    .then(response => response.json())
                                    .then(data => {
                                        // Restaurar bot√≥n
                                        checkBtn.disabled = false;
                                        checkBtn.textContent = originalText;
                                        checkBtn.style.opacity = '1';

                                        // Mostrar resultado
                                        resultDiv.style.display = 'block';

                                        if (data.success) {
                                            const apiStatus = data;

                                            if (apiStatus.online) {
                                                resultDiv.style.background = 'rgba(76, 175, 80, 0.2)';
                                                resultDiv.style.border = '1px solid rgba(76, 175, 80, 0.5)';
                                                resultDiv.style.color = '#4caf50';
                                                resultDiv.innerHTML = `
                        <strong>‚úÖ Conexi√≥n exitosa</strong><br>
                        Tiempo de respuesta: ${Math.round(apiStatus.response_time_ms || 0)}ms<br>
                        <small>${apiStatus.message || 'API conectada y respondiendo'}</small>
                    `;
                                            } else {
                                                resultDiv.style.background = 'rgba(244, 67, 54, 0.2)';
                                                resultDiv.style.border = '1px solid rgba(244, 67, 54, 0.5)';
                                                resultDiv.style.color = '#f44336';
                                                resultDiv.innerHTML = `
                        <strong>‚ùå Conexi√≥n fallida</strong><br>
                        <small>${apiStatus.message || 'No se pudo conectar a la API'}</small>
                    `;
                                            }

                                            // Recargar logs despu√©s de verificar
                                            loadApiLogs();

                                            // Actualizar el estado visual inmediatamente
                                            refreshApiStatus();
                                        } else {
                                            resultDiv.style.background = 'rgba(255, 152, 0, 0.2)';
                                            resultDiv.style.border = '1px solid rgba(255, 152, 0, 0.5)';
                                            resultDiv.style.color = '#ff9800';
                                            resultDiv.innerHTML = `
                    <strong>‚ö†Ô∏è Error al verificar</strong><br>
                    <small>${data.error || 'No se pudo obtener el estado de la API'}</small>
                `;
                                        }

                                        // Ocultar resultado despu√©s de 5 segundos
                                        setTimeout(() => {
                                            resultDiv.style.display = 'none';
                                        }, 5000);
                                    })
                                    .catch(error => {
                                        // Restaurar bot√≥n
                                        checkBtn.disabled = false;
                                        checkBtn.textContent = originalText;
                                        checkBtn.style.opacity = '1';

                                        // Mostrar error
                                        resultDiv.style.display = 'block';
                                        resultDiv.style.background = 'rgba(244, 67, 54, 0.2)';
                                        resultDiv.style.border = '1px solid rgba(244, 67, 54, 0.5)';
                                        resultDiv.style.color = '#f44336';
                                        resultDiv.innerHTML = `
                <strong>‚ùå Error de conexi√≥n</strong><br>
                <small>No se pudo verificar el estado de la API. Verifica tu conexi√≥n a internet.</small>
            `;

                                        console.error('Error al comprobar conexi√≥n:', error);

                                        // Ocultar resultado despu√©s de 5 segundos
                                        setTimeout(() => {
                                            resultDiv.style.display = 'none';
                                        }, 5000);
                                    });
                            }

                            // Actualizar estado de API al cargar la p√°gina y luego cada 30 segundos
                            refreshApiStatus();
                            setInterval(refreshApiStatus, 30000);

                            // Funciones para gesti√≥n de equipo
                            function openEmployeesModal() {
                                const modal = document.getElementById('employees-modal');
                                if (modal) {
                                    modal.style.display = 'flex';
                                    loadEmployees();
                                }
                            }

                            function closeEmployeesModal() {
                                const modal = document.getElementById('employees-modal');
                                if (modal) {
                                    modal.style.display = 'none';
                                    cancelEmployeeForm();
                                }
                            }

                            // Variable global para almacenar todo el equipo
                            let allEmployees = [];

                            function getCargoIcon(cargo) {
                                if (!cargo) return 'üë§';
                                const cargoUpper = cargo.toUpperCase();
                                if (cargoUpper.includes('BARRA')) return 'üç∫';
                                if (cargoUpper.includes('CAJA')) return 'üí∞';
                                if (cargoUpper.includes('GUARDIA')) return 'üõ°Ô∏è';
                                if (cargoUpper.includes('ANFITRIONA')) return 'üëã';
                                if (cargoUpper.includes('ASEO')) return 'üßπ';
                                if (cargoUpper.includes('GUARDARROP')) return 'üß•';
                                if (cargoUpper.includes('T√âCNICA') || cargoUpper.includes('TECNICA')) return 'üîß';
                                if (cargoUpper.includes('DRAG')) return 'üé≠';
                                if (cargoUpper.includes('DJ')) return 'üéµ';
                                if (cargoUpper.includes('COPERX')) return 'üç∏';
                                return 'üë§';
                            }

                            function loadEmployees() {
                                const listDiv = document.getElementById('employees-list');
                                if (!listDiv) return;

                                listDiv.innerHTML = '<p style="text-align: center; color: #aaa; padding: 20px;">Cargando equipo...</p>';

                                fetch('/admin/api/employees')
                                    .then(response => response.json())
                                    .then(data => {
                                        if (data.success) {
                                            allEmployees = data.employees || [];
                                            updateEmployeesDisplay();
                                            updateEmployeesStats();
                                        } else {
                                            listDiv.innerHTML = `
                    <div style="text-align: center; padding: 20px; background: rgba(244, 67, 54, 0.1); border: 1px solid rgba(244, 67, 54, 0.3); border-radius: 10px;">
                        <p style="color: #f44336; margin: 0;">Error al cargar equipo: ${data.message || 'Error desconocido'}</p>
                    </div>
                `;
                                        }
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                        listDiv.innerHTML = `
                <div style="text-align: center; padding: 20px; background: rgba(244, 67, 54, 0.1); border: 1px solid rgba(244, 67, 54, 0.3); border-radius: 10px;">
                    <p style="color: #f44336; margin: 0;">Error de conexi√≥n al cargar equipo</p>
                </div>
            `;
                                    });
                            }

                            function updateEmployeesStats() {
                                const total = allEmployees.length;
                                const active = allEmployees.filter(e => e.active).length;
                                const inactive = total - active;

                                document.getElementById('total-employees').textContent = total;
                                document.getElementById('active-employees').textContent = active;
                                document.getElementById('inactive-employees').textContent = inactive;
                            }

                            function filterEmployees() {
                                const searchTerm = (document.getElementById('employee-search')?.value || '').toLowerCase();
                                const filterCargo = document.getElementById('employee-filter-cargo')?.value || '';
                                const filterStatus = document.getElementById('employee-filter-status')?.value || '';

                                const filtered = allEmployees.filter(emp => {
                                    // B√∫squeda por nombre o cargo
                                    const matchesSearch = !searchTerm ||
                                        (emp.name || '').toLowerCase().includes(searchTerm) ||
                                        (emp.cargo || '').toLowerCase().includes(searchTerm);

                                    // Filtro por cargo
                                    const matchesCargo = !filterCargo ||
                                        (emp.cargo || '').toUpperCase().includes(filterCargo.toUpperCase());

                                    // Filtro por estado
                                    const matchesStatus = !filterStatus ||
                                        (filterStatus === 'active' && emp.active) ||
                                        (filterStatus === 'inactive' && !emp.active);

                                    return matchesSearch && matchesCargo && matchesStatus;
                                });

                                displayEmployees(filtered);
                            }

                            function displayEmployees(employees) {
                                const listDiv = document.getElementById('employees-list');
                                if (!listDiv) return;

                                if (employees.length === 0) {
                                    listDiv.innerHTML = `
            <div style="text-align: center; padding: 40px; background: rgba(102, 126, 234, 0.1); border: 1px solid rgba(102, 126, 234, 0.3); border-radius: 10px;">
                <p style="color: #667eea; font-size: 1.1rem; margin: 0;">No se encontraron miembros del equipo</p>
                <p style="color: #aaa; font-size: 0.9rem; margin-top: 10px;">Intenta ajustar los filtros de b√∫squeda</p>
            </div>
        `;
                                    return;
                                }

                                // Ordenar por nombre
                                employees.sort((a, b) => (a.name || '').localeCompare(b.name || ''));

                                let html = '<div style="display: grid; gap: 12px;">';
                                employees.forEach(emp => {
                                    const empId = String(emp.id);
                                    const empName = (emp.name || '').replace(/'/g, "\\'").replace(/"/g, '&quot;');
                                    const cargoIcon = getCargoIcon(emp.cargo);

                                    html += `
            <div style="background: rgba(26, 26, 46, 0.5); border: 1px solid ${emp.active ? 'rgba(76, 175, 80, 0.3)' : 'rgba(255, 152, 0, 0.3)'}; border-radius: 10px; padding: 15px; display: flex; justify-content: space-between; align-items: center; transition: all 0.3s ease;" 
                 onmouseover="this.style.borderColor='${emp.active ? 'rgba(76, 175, 80, 0.6)' : 'rgba(255, 152, 0, 0.6)'}'; this.style.transform='translateY(-2px)'"
                 onmouseout="this.style.borderColor='${emp.active ? 'rgba(76, 175, 80, 0.3)' : 'rgba(255, 152, 0, 0.3)'}'; this.style.transform='translateY(0)'">
                <div style="flex: 1; display: flex; align-items: center; gap: 15px;">
                    <div style="font-size: 2.5rem;">${cargoIcon}</div>
                    <div style="flex: 1;">
                        <h4 style="color: #e8e8e8; margin: 0 0 5px 0; font-size: 1.1rem; display: flex; align-items: center; gap: 8px;">
                            ${emp.name || 'Sin nombre'}
                            ${emp.active ? '<span style="display: inline-block; width: 8px; height: 8px; background: #4caf50; border-radius: 50%;"></span>' : '<span style="display: inline-block; width: 8px; height: 8px; background: #ff9800; border-radius: 50%;"></span>'}
                        </h4>
                        <div style="display: flex; gap: 15px; flex-wrap: wrap; font-size: 0.9rem; color: #aaa;">
                            <span><strong>Cargo:</strong> <span style="color: #667eea;">${emp.cargo || 'N/A'}</span></span>
                            <span><strong>PIN:</strong> <span style="color: ${emp.pin ? '#4caf50' : '#ff9800'};">${emp.pin ? '****' : 'No configurado'}</span></span>
                            <span><strong>Estado:</strong> <span style="color: ${emp.active ? '#4caf50' : '#ff9800'};">${emp.active ? '‚úÖ Activo' : '‚è∏Ô∏è Inactivo'}</span></span>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button onclick="editEmployee('${empId}')" style="padding: 8px 16px; background: rgba(102, 126, 234, 0.3); border: 1px solid rgba(102, 126, 234, 0.5); color: #667eea; border-radius: 5px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s;"
                            onmouseover="this.style.background='rgba(102, 126, 234, 0.5)'"
                            onmouseout="this.style.background='rgba(102, 126, 234, 0.3)'">
                        ‚úèÔ∏è Editar
                    </button>
                    <button onclick="deleteEmployee('${empId}', '${empName}')" style="padding: 8px 16px; background: rgba(244, 67, 54, 0.3); border: 1px solid rgba(244, 67, 54, 0.5); color: #f44336; border-radius: 5px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s;"
                            onmouseover="this.style.background='rgba(244, 67, 54, 0.5)'"
                            onmouseout="this.style.background='rgba(244, 67, 54, 0.3)'">
                        üóëÔ∏è Eliminar
                    </button>
        `;
                                });
                                html += '</div>';
                                listDiv.innerHTML = html;
                            }

                            function updateEmployeesDisplay() {
                                filterEmployees();
                            }

                            function openAddEmployeeForm() {
                                const formDiv = document.getElementById('add-employee-form');
                                const listDiv = document.getElementById('employees-list');

                                if (formDiv) {
                                    // Limpiar formulario
                                    document.getElementById('employee-form').reset();
                                    document.getElementById('employee-id').value = '';
                                    document.getElementById('employee-active').checked = true;

                                    // Ocultar lista y mostrar formulario
                                    if (listDiv) {
                                        listDiv.style.display = 'none';
                                    }
                                    formDiv.style.display = 'block';

                                    // Scroll suave al formulario
                                    setTimeout(() => {
                                        formDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                                    }, 100);
                                }
                            }

                            function cancelEmployeeForm() {
                                const formDiv = document.getElementById('add-employee-form');
                                const listDiv = document.getElementById('employees-list');

                                if (formDiv) {
                                    // Limpiar formulario
                                    document.getElementById('employee-form').reset();
                                    document.getElementById('employee-id').value = '';
                                    document.getElementById('employee-active').checked = true;

                                    // Ocultar formulario y mostrar lista
                                    formDiv.style.display = 'none';
                                    if (listDiv) {
                                        listDiv.style.display = 'block';
                                    }
                                }
                            }

                            function editEmployee(id) {
                                fetch(`/admin/api/employees/${encodeURIComponent(id)}`)
                                    .then(response => response.json())
                                    .then(data => {
                                        if (data.success && data.employee) {
                                            const emp = data.employee;
                                            document.getElementById('employee-id').value = emp.id;
                                            document.getElementById('employee-name').value = emp.name || '';
                                            document.getElementById('employee-cargo').value = emp.cargo || '';
                                            document.getElementById('employee-pin').value = emp.pin || '';
                                            document.getElementById('employee-active').checked = emp.active !== false;

                                            const formDiv = document.getElementById('add-employee-form');
                                            const listDiv = document.getElementById('employees-list');
                                            if (formDiv) {
                                                // Ocultar lista y mostrar formulario
                                                if (listDiv) {
                                                    listDiv.style.display = 'none';
                                                }
                                                formDiv.style.display = 'block';
                                                // Scroll suave al formulario
                                                setTimeout(() => {
                                                    formDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                                                }, 100);
                                            }
                                        } else {
                                            alert('Error al cargar el miembro del equipo: ' + (data.message || 'Error desconocido'));
                                        }
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                        alert('Error de conexi√≥n al cargar el miembro del equipo');
                                    });
                            }

                            function deleteEmployee(id, name) {
                                if (!confirm(`¬øEst√°s seguro de que deseas eliminar al miembro del equipo "${name}"?\n\nEsta acci√≥n no se puede deshacer.`)) {
                                    return;
                                }

                                fetch(`/admin/api/employees/${encodeURIComponent(id)}`, {
                                    method: 'DELETE'
                                })
                                    .then(response => response.json())
                                    .then(data => {
                                        if (data.success) {
                                            showEmployeeMessage('‚úÖ Miembro del equipo eliminado correctamente', 'success');
                                            loadEmployees();
                                        } else {
                                            showEmployeeMessage('‚ùå Error al eliminar: ' + (data.message || 'Error desconocido'), 'error');
                                        }
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                        showEmployeeMessage('‚ùå Error de conexi√≥n al eliminar el miembro del equipo', 'error');
                                    });
                            }

                            function saveEmployee(event) {
                                event.preventDefault();

                                const form = event.target;
                                const employeeId = document.getElementById('employee-id').value;

                                const data = {
                                    name: document.getElementById('employee-name').value.trim(),
                                    cargo: document.getElementById('employee-cargo').value.trim(),
                                    pin: document.getElementById('employee-pin').value.trim(),
                                    active: document.getElementById('employee-active').checked
                                };

                                if (!data.name) {
                                    alert('‚ùå El nombre es obligatorio');
                                    return;
                                }

                                const url = employeeId ? `/admin/api/employees/${encodeURIComponent(employeeId)}` : '/admin/api/employees';
                                const method = employeeId ? 'PUT' : 'POST';

                                const submitBtn = form.querySelector('button[type="submit"]');
                                const originalText = submitBtn.textContent;
                                submitBtn.disabled = true;
                                submitBtn.textContent = '‚è≥ Guardando...';

                                fetch(url, {
                                    method: method,
                                    headers: {
                                        'Content-Type': 'application/json',
                                    },
                                    body: JSON.stringify(data)
                                })
                                    .then(response => response.json())
                                    .then(result => {
                                        submitBtn.disabled = false;
                                        submitBtn.textContent = originalText;

                                        if (result.success) {
                                            // Mostrar mensaje de √©xito m√°s elegante
                                            showEmployeeMessage('‚úÖ Miembro del equipo guardado correctamente', 'success');
                                            cancelEmployeeForm();
                                            loadEmployees();
                                        } else {
                                            showEmployeeMessage('‚ùå Error al guardar: ' + (result.message || 'Error desconocido'), 'error');
                                        }
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                        submitBtn.disabled = false;
                                        submitBtn.textContent = originalText;
                                        alert('‚ùå Error de conexi√≥n al guardar el miembro del equipo');
                                    });
                            }

                            // Funci√≥n para mostrar mensajes elegantes
                            function showEmployeeMessage(message, type) {
                                const messageDiv = document.createElement('div');
                                messageDiv.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 25px;
        background: ${type === 'success' ? 'rgba(76, 175, 80, 0.9)' : 'rgba(244, 67, 54, 0.9)'};
        color: white;
        border-radius: 8px;
        z-index: 10001;
        font-weight: 600;
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        animation: slideIn 0.3s ease;
    `;
                                messageDiv.textContent = message;
                                document.body.appendChild(messageDiv);

                                setTimeout(() => {
                                    messageDiv.style.animation = 'slideOut 0.3s ease';
                                    setTimeout(() => messageDiv.remove(), 300);
                                }, 3000);
                            }

                            // Validaci√≥n mejorada del PIN
                            document.addEventListener('DOMContentLoaded', function () {
                                const pinInput = document.getElementById('employee-pin');
                                if (pinInput) {
                                    pinInput.addEventListener('input', function (e) {
                                        // Solo permitir n√∫meros
                                        e.target.value = e.target.value.replace(/[^0-9]/g, '');
                                        // Limitar a 4 d√≠gitos
                                        if (e.target.value.length > 4) {
                                            e.target.value = e.target.value.slice(0, 4);
                                        }
                                    });
                                }
                            });

                            // Cerrar modal de equipo al hacer clic fuera
                            document.addEventListener('click', function (event) {
                                const modal = document.getElementById('employees-modal');
                                if (modal && event.target === modal) {
                                    closeEmployeesModal();
                                }
                            });

                            // Agregar estilos de animaci√≥n
                            const style = document.createElement('style');
                            style.textContent = `
    @keyframes slideIn {
        from {
            transform: translateX(400px);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }
    @keyframes slideOut {
        from {
            transform: translateX(0);
            opacity: 1;
        }
        to {
            transform: translateX(400px);
            opacity: 0;
        }
    }
`;
                            document.head.appendChild(style);


                            // Funciones para control de servicios externos
                            function loadServicesStatus() {
                                fetch('/admin/api/services/status')
                                    .then(response => response.json())
                                    .then(data => {
                                        if (data.success && data.services) {
                                            updateServicesUI(data.services);
                                        }
                                    })
                                    .catch(error => {
                                        console.error('Error al cargar estado de servicios:', error);
                                    });
                            }

                            function updateServicesUI(services) {
                                // Actualizar estado de API
                                const apiBtn = document.getElementById('toggle-api-btn');
                                const apiStatus = document.getElementById('api-service-status');
                                if (apiBtn && apiStatus) {
                                    const enabled = services.api.enabled;
                                    apiBtn.textContent = enabled ? 'üü¢ Activar' : 'üî¥ Desactivar';
                                    apiBtn.style.background = enabled ? 'rgba(76, 175, 80, 0.3)' : 'rgba(244, 67, 54, 0.3)';
                                    apiBtn.style.borderColor = enabled ? 'rgba(76, 175, 80, 0.5)' : 'rgba(244, 67, 54, 0.5)';
                                    apiBtn.style.color = enabled ? '#4caf50' : '#f44336';
                                    if (enabled) {
                                        apiStatus.classList.remove('status-offline');
                                        apiStatus.classList.add('status-online');
                                    } else {
                                        apiStatus.classList.remove('status-online');
                                        apiStatus.classList.add('status-offline');
                                    }
                                }

                                // Actualizar estado de OpenAI
                                const openaiBtn = document.getElementById('toggle-openai-btn');
                                const openaiStatus = document.getElementById('openai-service-status');
                                if (openaiBtn && openaiStatus) {
                                    const enabled = services.openai.enabled;
                                    // Si est√° activo, mostrar opci√≥n de desactivar. Si est√° inactivo, mostrar opci√≥n de activar.
                                    openaiBtn.textContent = enabled ? 'üî¥ Desactivar' : 'üü¢ Activar';
                                    openaiBtn.style.background = enabled ? 'rgba(244, 67, 54, 0.3)' : 'rgba(76, 175, 80, 0.3)';
                                    openaiBtn.style.borderColor = enabled ? 'rgba(244, 67, 54, 0.5)' : 'rgba(76, 175, 80, 0.5)';
                                    openaiBtn.style.color = enabled ? '#f44336' : '#4caf50';
                                    if (enabled) {
                                        openaiStatus.classList.remove('status-offline');
                                        openaiStatus.classList.add('status-online');
                                    } else {
                                        openaiStatus.classList.remove('status-online');
                                        openaiStatus.classList.add('status-offline');
                                    }
                                }

                                // Actualizar estado de GetNet
                                const getnetBtn = document.getElementById('toggle-getnet-btn');
                                const getnetStatus = document.getElementById('getnet-service-status');
                                if (getnetBtn && getnetStatus) {
                                    const enabled = services.getnet.enabled;
                                    // Si est√° activo, mostrar opci√≥n de desactivar. Si est√° inactivo, mostrar opci√≥n de activar.
                                    getnetBtn.textContent = enabled ? 'üî¥ Desactivar' : 'üü¢ Activar';
                                    getnetBtn.style.background = enabled ? 'rgba(244, 67, 54, 0.3)' : 'rgba(76, 175, 80, 0.3)';
                                    getnetBtn.style.borderColor = enabled ? 'rgba(244, 67, 54, 0.5)' : 'rgba(76, 175, 80, 0.5)';
                                    getnetBtn.style.color = enabled ? '#f44336' : '#4caf50';
                                    if (enabled) {
                                        getnetStatus.classList.remove('status-offline');
                                        getnetStatus.classList.add('status-online');
                                    } else {
                                        getnetStatus.classList.remove('status-online');
                                        getnetStatus.classList.add('status-offline');
                                    }
                                }

                                // Actualizar estado de SumUp
                                const sumupBtn = document.getElementById('toggle-sumup-btn');
                                const sumupStatus = document.getElementById('sumup-service-status');
                                if (sumupBtn && sumupStatus) {
                                    const enabled = services.sumup.enabled;
                                    // Si est√° activo, mostrar opci√≥n de desactivar. Si est√° inactivo, mostrar opci√≥n de activar.
                                    sumupBtn.textContent = enabled ? 'üî¥ Desactivar' : 'üü¢ Activar';
                                    sumupBtn.style.background = enabled ? 'rgba(244, 67, 54, 0.3)' : 'rgba(76, 175, 80, 0.3)';
                                    sumupBtn.style.borderColor = enabled ? 'rgba(244, 67, 54, 0.5)' : 'rgba(76, 175, 80, 0.5)';
                                    sumupBtn.style.color = enabled ? '#f44336' : '#4caf50';
                                    if (enabled) {
                                        sumupStatus.classList.remove('status-offline');
                                        sumupStatus.classList.add('status-online');
                                    } else {
                                        sumupStatus.classList.remove('status-online');
                                        sumupStatus.classList.add('status-offline');
                                    }
                                }
                            }

                            function toggleService(serviceName) {
                                // Obtener estado actual
                                fetch('/admin/api/services/status')
                                    .then(response => response.json())
                                    .then(data => {
                                        if (data.success && data.services) {
                                            const currentState = data.services[serviceName];
                                            const newState = !currentState.enabled;

                                            // Confirmar acci√≥n
                                            const action = newState ? 'activar' : 'desactivar';
                                            if (!confirm(`¬øEst√°s seguro de que deseas ${action} el servicio ${currentState.name}?`)) {
                                                return;
                                            }

                                            // Actualizar UI inmediatamente
                                            const btn = document.getElementById(`toggle-${serviceName}-btn`);
                                            const messageDiv = document.getElementById('services-toggle-message');

                                            if (btn) {
                                                btn.disabled = true;
                                                btn.textContent = '‚è≥ Procesando...';
                                            }

                                            // Llamar a la API
                                            fetch('/admin/api/services/toggle', {
                                                method: 'POST',
                                                headers: {
                                                    'Content-Type': 'application/json'
                                                },
                                                body: JSON.stringify({
                                                    service: serviceName,
                                                    enabled: newState
                                                })
                                            })
                                                .then(response => response.json())
                                                .then(result => {
                                                    if (result.success) {
                                                        messageDiv.style.display = 'block';
                                                        messageDiv.style.background = 'rgba(76, 175, 80, 0.2)';
                                                        messageDiv.style.border = '1px solid rgba(76, 175, 80, 0.5)';
                                                        messageDiv.style.color = '#4caf50';
                                                        messageDiv.textContent = `‚úÖ ${result.message}`;

                                                        // Recargar estado
                                                        loadServicesStatus();

                                                        // Reiniciar bot√≥n despu√©s de un momento
                                                        setTimeout(() => {
                                                            if (btn) {
                                                                btn.disabled = false;
                                                            }
                                                        }, 1000);
                                                    } else {
                                                        messageDiv.style.display = 'block';
                                                        messageDiv.style.background = 'rgba(244, 67, 54, 0.2)';
                                                        messageDiv.style.border = '1px solid rgba(244, 67, 54, 0.5)';
                                                        messageDiv.style.color = '#f44336';
                                                        messageDiv.textContent = `‚ùå Error: ${result.message}`;

                                                        if (btn) {
                                                            btn.disabled = false;
                                                        }

                                                        // Recargar estado
                                                        loadServicesStatus();
                                                    }
                                                })
                                                .catch(error => {
                                                    console.error('Error:', error);
                                                    messageDiv.style.display = 'block';
                                                    messageDiv.style.background = 'rgba(244, 67, 54, 0.2)';
                                                    messageDiv.style.border = '1px solid rgba(244, 67, 54, 0.5)';
                                                    messageDiv.style.color = '#f44336';
                                                    messageDiv.textContent = '‚ùå Error de conexi√≥n';

                                                    if (btn) {
                                                        btn.disabled = false;
                                                    }

                                                    // Recargar estado
                                                    loadServicesStatus();
                                                });
                                        }
                                    })
                                    .catch(error => {
                                        console.error('Error al obtener estado:', error);
                                    });
                            }

                            // Cargar estado de servicios al iniciar
                            document.addEventListener('DOMContentLoaded', function () {
                                loadServicesStatus();
                            });

                            // Funciones para mostrar/ocultar logs de servicios (colapso)
                            function toggleServiceLog(serviceName) {
                                const collapse = document.getElementById(`${serviceName}-log-collapse`);
                                const content = document.getElementById(`${serviceName}-log-content`);

                                if (!collapse || !content) {
                                    console.error(`No se encontr√≥ el colapso para ${serviceName}`);
                                    return;
                                }

                                // Si est√° oculto, mostrar y cargar logs
                                if (collapse.style.display === 'none' || !collapse.style.display) {
                                    collapse.style.display = 'block';
                                    content.innerHTML = '<div style="text-align: center; padding: 20px; color: #aaa;">‚è≥ Cargando logs...</div>';
                                    loadServiceLogs(serviceName);
                                } else {
                                    // Si est√° visible, ocultar
                                    collapse.style.display = 'none';
                                }
                            }

                            function loadServiceLogs(serviceName) {
                                const content = document.getElementById(`${serviceName}-log-content`);

                                if (!content) {
                                    console.error(`No se encontr√≥ el contenido de logs para ${serviceName}`);
                                    return;
                                }

                                fetch(`/admin/api/services/${serviceName}/logs`, {
                                    credentials: 'same-origin',
                                    headers: {
                                        'Content-Type': 'application/json'
                                    }
                                })
                                    .then(response => {
                                        if (!response.ok) {
                                            return response.json().then(err => {
                                                throw new Error(err.message || `Error HTTP ${response.status}`);
                                            });
                                        }
                                        return response.json();
                                    })
                                    .then(data => {
                                        if (data && data.success) {
                                            if (data.logs && data.logs.length > 0) {
                                                let html = '<div style="max-height: 400px; overflow-y: auto;">';
                                                html += '<table style="width: 100%; border-collapse: collapse; font-size: 0.85rem;">';
                                                html += '<thead><tr style="border-bottom: 2px solid rgba(102, 126, 234, 0.5); background: rgba(26, 26, 46, 0.95);">';
                                                html += '<th style="padding: 10px; text-align: left; color: #667eea; font-weight: 600;">Fecha/Hora</th>';
                                                html += '<th style="padding: 10px; text-align: left; color: #667eea; font-weight: 600;">Estado</th>';
                                                html += '<th style="padding: 10px; text-align: left; color: #667eea; font-weight: 600;">Mensaje</th>';
                                                html += '</tr></thead><tbody>';

                                                data.logs.forEach(log => {
                                                    const statusColor = log.status === 'online' || log.status === 'success' ? '#4caf50' :
                                                        (log.status === 'offline' || log.status === 'error' ? '#f44336' : '#ff9800');
                                                    const statusIcon = log.status === 'online' || log.status === 'success' ? '‚úÖ' :
                                                        (log.status === 'offline' || log.status === 'error' ? '‚ùå' : '‚ö†Ô∏è');

                                                    html += '<tr style="border-bottom: 1px solid rgba(102, 126, 234, 0.2);">';
                                                    html += `<td style="padding: 8px; color: #aaa; font-size: 0.8rem;">${log.timestamp || 'N/A'}</td>`;
                                                    html += `<td style="padding: 8px; color: ${statusColor}; font-weight: bold; font-size: 0.8rem;">${statusIcon} ${(log.status || 'unknown').toUpperCase()}</td>`;
                                                    html += `<td style="padding: 8px; color: #888; font-size: 0.8rem;">${log.message || log.error || 'N/A'}</td>`;
                                                    html += '</tr>';
                                                });

                                                html += '</tbody></table></div>';
                                                content.innerHTML = html;
                                            } else {
                                                content.innerHTML = `
                        <div style="text-align: center; padding: 30px; color: #aaa;">
                            <p style="font-size: 1rem; margin-bottom: 10px;">üì≠</p>
                            <p>No hay logs disponibles para este servicio a√∫n.</p>
                        </div>
                    `;
                                            }
                                        } else {
                                            content.innerHTML = `
                    <div style="text-align: center; padding: 30px; color: #f44336;">
                        <p style="font-size: 1rem; margin-bottom: 10px;">‚ùå</p>
                        <p>Error al cargar los logs.</p>
                        <p style="font-size: 0.85rem; margin-top: 10px;">${data?.message || 'Error desconocido'}</p>
                    </div>
                `;
                                        }
                                    })
                                    .catch(error => {
                                        console.error('Error al cargar logs:', error);
                                        content.innerHTML = `
                <div style="text-align: center; padding: 30px; color: #f44336;">
                    <p style="font-size: 1rem; margin-bottom: 10px;">‚ùå</p>
                    <p>Error al cargar los logs.</p>
                    <p style="font-size: 0.85rem; margin-top: 10px;">${error.message || 'Error desconocido'}</p>
                </div>
            `;
                                    });
                            }


                            // Funci√≥n para reiniciar todo el sistema
                            function restartEverything() {
                                const btn = document.getElementById('restart-everything-btn');
                                const messageDiv = document.getElementById('restart-everything-message');

                                // Confirmar acci√≥n con advertencia clara
                                const confirmMessage = '¬øEst√°s seguro de que deseas REINICIAR TODO el sistema?\n\n' +
                                    'Esto incluir√°:\n' +
                                    '‚Ä¢ Reinicio de todos los servicios\n' +
                                    '‚Ä¢ Limpieza de cach√©s\n' +
                                    '‚Ä¢ Recarga de configuraci√≥n\n' +
                                    '‚Ä¢ La p√°gina se recargar√° autom√°ticamente\n\n' +
                                    'Esta acci√≥n no se puede deshacer.';

                                if (!confirm(confirmMessage)) {
                                    return;
                                }

                                // Deshabilitar bot√≥n
                                const originalText = btn.textContent;
                                btn.disabled = true;
                                btn.textContent = '‚è≥ Reiniciando Todo...';
                                btn.style.opacity = '0.7';
                                btn.style.cursor = 'not-allowed';

                                messageDiv.style.display = 'block';
                                messageDiv.style.background = 'rgba(255, 152, 0, 0.2)';
                                messageDiv.style.border = '1px solid rgba(255, 152, 0, 0.5)';
                                messageDiv.style.color = '#ff9800';
                                messageDiv.innerHTML = '<strong>‚è≥ Reiniciando todo el sistema...</strong><br><small>Por favor espera, esto puede tomar unos segundos.</small>';

                                // Llamar a la API
                                fetch('/admin/api/restart-everything', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json'
                                    }
                                })
                                    .then(response => response.json())
                                    .then(data => {
                                        if (data.success) {
                                            messageDiv.style.background = 'rgba(76, 175, 80, 0.2)';
                                            messageDiv.style.border = '1px solid rgba(76, 175, 80, 0.5)';
                                            messageDiv.style.color = '#4caf50';
                                            messageDiv.innerHTML = `<strong>‚úÖ ${data.message || 'Sistema reiniciado correctamente'}</strong><br><small>La p√°gina se recargar√° en 5 segundos...</small>`;

                                            // Recargar la p√°gina despu√©s de 5 segundos
                                            setTimeout(() => {
                                                window.location.reload();
                                            }, 5000);
                                        } else {
                                            btn.disabled = false;
                                            btn.textContent = originalText;
                                            btn.style.opacity = '1';
                                            btn.style.cursor = 'pointer';

                                            messageDiv.style.background = 'rgba(244, 67, 54, 0.2)';
                                            messageDiv.style.border = '1px solid rgba(244, 67, 54, 0.5)';
                                            messageDiv.style.color = '#f44336';
                                            messageDiv.innerHTML = `<strong>‚ùå Error:</strong> ${data.message || 'No se pudo reiniciar el sistema'}`;
                                        }
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                        btn.disabled = false;
                                        btn.textContent = originalText;
                                        btn.style.opacity = '1';
                                        btn.style.cursor = 'pointer';

                                        messageDiv.style.background = 'rgba(244, 67, 54, 0.2)';
                                        messageDiv.style.border = '1px solid rgba(244, 67, 54, 0.5)';
                                        messageDiv.style.color = '#f44336';
                                        messageDiv.innerHTML = '<strong>‚ùå Error de conexi√≥n</strong><br><small>No se pudo reiniciar el sistema. Verifica tu conexi√≥n.</small>';
                                    });
                            }

                            // Funciones para configurar servicios
                            function openServiceConfig(serviceName) {
                                const modal = document.getElementById('service-config-modal');
                                const title = document.getElementById('service-config-title');
                                const content = document.getElementById('service-config-content');

                                if (!modal || !title || !content) return;

                                // Configurar t√≠tulo y contenido seg√∫n el servicio
                                let serviceTitle = '';
                                let serviceConfigHTML = '';

                                if (serviceName === 'openai') {
                                    serviceTitle = 'ü§ñ Configurar OpenAI';
                                    serviceConfigHTML = `
            <p style="color: #aaa; margin-bottom: 20px; font-size: 0.9rem;">
                Configura las credenciales de OpenAI para habilitar el agente virtual de redes sociales.
            </p>
            <div style="margin-bottom: 20px;">
                <label style="display: block; color: #e8e8e8; margin-bottom: 8px; font-weight: 600;">
                    API Key:
                </label>
                <input type="password" id="openai-api-key" name="api_key" 
                       placeholder="sk-..."
                       style="width: 100%; padding: 12px; background: rgba(26, 26, 46, 0.5); border: 1px solid rgba(102, 126, 234, 0.3); border-radius: 8px; color: #e8e8e8; font-size: 0.95rem; font-family: monospace;"
                       required>
                <p style="font-size: 0.85rem; color: #aaa; margin-top: 5px;">
                    Tu API key de OpenAI (comienza con sk-)
                </p>
            </div>
            <div style="margin-bottom: 20px;">
                <label style="display: block; color: #e8e8e8; margin-bottom: 8px; font-weight: 600;">
                    Organization ID (Opcional):
                </label>
                <input type="text" id="openai-org-id" name="org_id" 
                       placeholder="org-..."
                       style="width: 100%; padding: 12px; background: rgba(26, 26, 46, 0.5); border: 1px solid rgba(102, 126, 234, 0.3); border-radius: 8px; color: #e8e8e8; font-size: 0.95rem;">
                <p style="font-size: 0.85rem; color: #aaa; margin-top: 5px;">
                    ID de organizaci√≥n de OpenAI (opcional)
                </p>
            </div>
            <div style="margin-bottom: 20px;">
                <label style="display: block; color: #e8e8e8; margin-bottom: 8px; font-weight: 600;">
                    Project ID (Opcional):
                </label>
                <input type="text" id="openai-project-id" name="project_id" 
                       placeholder="proj-..."
                       style="width: 100%; padding: 12px; background: rgba(26, 26, 46, 0.5); border: 1px solid rgba(102, 126, 234, 0.3); border-radius: 8px; color: #e8e8e8; font-size: 0.95rem;">
                <p style="font-size: 0.85rem; color: #aaa; margin-top: 5px;">
                    ID de proyecto de OpenAI (opcional)
                </p>
            </div>
            <input type="hidden" name="service" value="openai">
        `;
                                } else if (serviceName === 'getnet') {
                                    serviceTitle = 'üí≥ Configurar GetNet';
                                    serviceConfigHTML = `
            <p style="color: #aaa; margin-bottom: 20px; font-size: 0.9rem;">
                Configura la integraci√≥n de pagos GetNet POS.
            </p>
            <div style="margin-bottom: 20px;">
                <label style="display: block; color: #e8e8e8; margin-bottom: 8px; font-weight: 600;">
                    Server Host:
                </label>
                <input type="text" id="getnet-host" name="host" 
                       placeholder="localhost"
                       style="width: 100%; padding: 12px; background: rgba(26, 26, 46, 0.5); border: 1px solid rgba(102, 126, 234, 0.3); border-radius: 8px; color: #e8e8e8; font-size: 0.95rem;"
                       required>
                <p style="font-size: 0.85rem; color: #aaa; margin-top: 5px;">
                    Host del servidor GetNet
                </p>
            </div>
            <div style="margin-bottom: 20px;">
                <label style="display: block; color: #e8e8e8; margin-bottom: 8px; font-weight: 600;">
                    Server Port:
                </label>
                <input type="number" id="getnet-port" name="port" 
                       placeholder="8020"
                       value="8020"
                       style="width: 100%; padding: 12px; background: rgba(26, 26, 46, 0.5); border: 1px solid rgba(102, 126, 234, 0.3); border-radius: 8px; color: #e8e8e8; font-size: 0.95rem;"
                       required>
                <p style="font-size: 0.85rem; color: #aaa; margin-top: 5px;">
                    Puerto del servidor GetNet
                </p>
            </div>
            <input type="hidden" name="service" value="getnet">
        `;
                                } else if (serviceName === 'sumup') {
                                    serviceTitle = 'üì± Configurar SumUp';
                                    serviceConfigHTML = `
            <p style="color: #aaa; margin-bottom: 20px; font-size: 0.9rem;">
                Configura la integraci√≥n de pagos m√≥viles SumUp.
            </p>
            <div style="margin-bottom: 20px;">
                <label style="display: block; color: #e8e8e8; margin-bottom: 8px; font-weight: 600;">
                    API Key:
                </label>
                <input type="password" id="sumup-api-key" name="api_key" 
                       placeholder="Ingresa tu API key de SumUp"
                       style="width: 100%; padding: 12px; background: rgba(26, 26, 46, 0.5); border: 1px solid rgba(102, 126, 234, 0.3); border-radius: 8px; color: #e8e8e8; font-size: 0.95rem; font-family: monospace;"
                       required>
                <p style="font-size: 0.85rem; color: #aaa; margin-top: 5px;">
                    Tu API key de SumUp
                </p>
            </div>
            <input type="hidden" name="service" value="sumup">
        `;
                                }

                                title.textContent = serviceTitle;
                                content.innerHTML = serviceConfigHTML;
                                modal.style.display = 'flex';
                            }

                            function closeServiceConfigModal() {
                                const modal = document.getElementById('service-config-modal');
                                const messageDiv = document.getElementById('service-config-message');
                                if (modal) {
                                    modal.style.display = 'none';
                                }
                                if (messageDiv) {
                                    messageDiv.style.display = 'none';
                                    messageDiv.textContent = '';
                                }
                                // Limpiar formulario
                                const form = document.getElementById('service-config-form');
                                if (form) {
                                    form.reset();
                                }
                            }

                            function saveServiceConfig(event) {
                                event.preventDefault();
                                const form = event.target;
                                const formData = new FormData(form);
                                const service = formData.get('service');
                                const messageDiv = document.getElementById('service-config-message');

                                // Preparar datos seg√∫n el servicio
                                const configData = {
                                    service: service
                                };

                                if (service === 'openai') {
                                    configData.api_key = document.getElementById('openai-api-key').value.trim();
                                    configData.org_id = document.getElementById('openai-org-id').value.trim() || null;
                                    configData.project_id = document.getElementById('openai-project-id').value.trim() || null;
                                } else if (service === 'getnet') {
                                    configData.host = document.getElementById('getnet-host').value.trim();
                                    configData.port = parseInt(document.getElementById('getnet-port').value) || 8020;
                                } else if (service === 'sumup') {
                                    configData.api_key = document.getElementById('sumup-api-key').value.trim();
                                }

                                // Mostrar mensaje de carga
                                messageDiv.style.display = 'block';
                                messageDiv.style.background = 'rgba(255, 152, 0, 0.2)';
                                messageDiv.style.border = '1px solid rgba(255, 152, 0, 0.5)';
                                messageDiv.style.color = '#ff9800';
                                messageDiv.textContent = '‚è≥ Guardando configuraci√≥n...';

                                // Enviar a la API
                                fetch('/admin/api/services/configure', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json'
                                    },
                                    body: JSON.stringify(configData)
                                })
                                    .then(response => response.json())
                                    .then(result => {
                                        if (result.success) {
                                            messageDiv.style.background = 'rgba(76, 175, 80, 0.2)';
                                            messageDiv.style.border = '1px solid rgba(76, 175, 80, 0.5)';
                                            messageDiv.style.color = '#4caf50';
                                            messageDiv.textContent = `‚úÖ ${result.message || 'Configuraci√≥n guardada correctamente'}`;

                                            // Recargar estado de servicios
                                            setTimeout(() => {
                                                loadServicesStatus();
                                                closeServiceConfigModal();
                                                // Recargar p√°gina despu√©s de 2 segundos para aplicar cambios
                                                setTimeout(() => {
                                                    window.location.reload();
                                                }, 2000);
                                            }, 1500);
                                        } else {
                                            messageDiv.style.background = 'rgba(244, 67, 54, 0.2)';
                                            messageDiv.style.border = '1px solid rgba(244, 67, 54, 0.5)';
                                            messageDiv.style.color = '#f44336';
                                            messageDiv.textContent = `‚ùå Error: ${result.message || 'No se pudo guardar la configuraci√≥n'}`;
                                        }
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                        messageDiv.style.background = 'rgba(244, 67, 54, 0.2)';
                                        messageDiv.style.border = '1px solid rgba(244, 67, 54, 0.5)';
                                        messageDiv.style.color = '#f44336';
                                        messageDiv.textContent = '‚ùå Error de conexi√≥n. Por favor, intenta nuevamente.';
                                    });
                            }

                            // Funci√≥n para desplegar a producci√≥n
                            function deployToProduction() {
                                const btn = document.getElementById('deploy-btn');
                                const statusDiv = document.getElementById('deploy-status');

                                if (!btn || !statusDiv) return;

                                // Confirmar
                                if (!confirm('¬øEst√°s seguro de que quieres actualizar el sitio en producci√≥n?\n\nEsto desplegar√° los √∫ltimos cambios a stvaldivia.cl')) {
                                    return;
                                }

                                // Deshabilitar bot√≥n
                                const originalText = btn.innerHTML;
                                btn.disabled = true;
                                btn.innerHTML = '‚è≥ Desplegando...';
                                btn.style.opacity = '0.6';

                                // Mostrar status
                                statusDiv.style.display = 'block';
                                statusDiv.style.background = 'rgba(102, 126, 234, 0.2)';
                                statusDiv.style.border = '1px solid rgba(102, 126, 234, 0.5)';
                                statusDiv.style.color = '#667eea';
                                statusDiv.innerHTML = '‚è≥ Iniciando deployment...';

                                // Llamar al endpoint
                                fetch('/admin/api/deploy', {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json'
                                    }
                                })
                                    .then(response => response.json())
                                    .then(data => {
                                        if (data.success) {
                                            statusDiv.style.background = 'rgba(76, 175, 80, 0.2)';
                                            statusDiv.style.border = '1px solid rgba(76, 175, 80, 0.5)';
                                            statusDiv.style.color = '#4caf50';
                                            statusDiv.innerHTML = `
                                            <strong>‚úÖ Deployment exitoso!</strong><br>
                                            <small>${data.message || 'El sitio se actualizar√° en 2-3 minutos'}</small><br>
                                            <small style="margin-top: 5px; display: block;">Revisi√≥n: ${data.revision || 'N/A'}</small>
                                        `;

                                            // Restaurar bot√≥n despu√©s de 5 segundos
                                            setTimeout(() => {
                                                btn.disabled = false;
                                                btn.innerHTML = originalText;
                                                btn.style.opacity = '1';
                                            }, 5000);
                                        } else {
                                            statusDiv.style.background = 'rgba(244, 67, 54, 0.2)';
                                            statusDiv.style.border = '1px solid rgba(244, 67, 54, 0.5)';
                                            statusDiv.style.color = '#f44336';
                                            statusDiv.innerHTML = `
                                            <strong>‚ùå Error en deployment</strong><br>
                                            <small>${data.error || 'No se pudo desplegar'}</small>
                                        `;

                                            btn.disabled = false;
                                            btn.innerHTML = originalText;
                                            btn.style.opacity = '1';
                                        }
                                    })
                                    .catch(error => {
                                        console.error('Error:', error);
                                        statusDiv.style.background = 'rgba(244, 67, 54, 0.2)';
                                        statusDiv.style.border = '1px solid rgba(244, 67, 54, 0.5)';
                                        statusDiv.style.color = '#f44336';
                                        statusDiv.innerHTML = `
                                        <strong>‚ùå Error de conexi√≥n</strong><br>
                                        <small>No se pudo conectar con el servidor</small>
                                    `;

                                        btn.disabled = false;
                                        btn.innerHTML = originalText;
                                        btn.style.opacity = '1';
                                    });
                            }

                            // Cerrar modal de configuraci√≥n al hacer clic fuera
                            document.addEventListener('click', function (event) {
                                const modal = document.getElementById('service-config-modal');
                                if (modal && event.target === modal) {
                                    closeServiceConfigModal();
                                }
                            });

                        </script>

                        <script>
                            // Confirmaci√≥n personalizada para reiniciar servicio
                            document.addEventListener('DOMContentLoaded', function () {
                                const restartForm = document.getElementById('restart-form');
                                if (restartForm) {
                                    restartForm.addEventListener('submit', async function (e) {
                                        e.preventDefault();

                                        const confirmed = await confirmDanger(
                                            '¬øEst√°s seguro de que deseas reiniciar el servicio? El servidor se reiniciar√° y deber√°s esperar unos segundos antes de poder usarlo nuevamente.',
                                            '‚ö†Ô∏è Reiniciar Servicio'
                                        );

                                        if (confirmed) {
                                            showLoading('Reiniciando servicio...');

                                            // Enviar formulario
                                            const formData = new FormData(this);

                                            try {
                                                const response = await fetch('{{ url_for("routes.restart_service") }}', {
                                                    method: 'POST',
                                                    body: formData
                                                });

                                                hideLoading();

                                                if (response.ok) {
                                                    showSuccess('‚úÖ Servicio reiniciado. La p√°gina se recargar√° en unos segundos...');
                                                    setTimeout(() => {
                                                        window.location.reload();
                                                    }, 2000);
                                                } else {
                                                    showError('‚ùå Error al reiniciar el servicio');
                                                }
                                            } catch (error) {
                                                hideLoading();
                                                console.error('Error:', error);
                                                showError('‚ùå Error de conexi√≥n al reiniciar el servicio');
                                            }
                                        }
                                    });
                                }
                            });
                        </script>

                        <!-- Modal para Configurar Servicios -->
                        <div id="service-config-modal"
                            style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 10002; align-items: center; justify-content: center;">
                            <div
                                style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border: 2px solid rgba(102, 126, 234, 0.5); border-radius: 15px; padding: 30px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; box-shadow: 0 10px 50px rgba(0,0,0,0.5);">
                                <div
                                    style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                                    <h2 id="service-config-title" style="color: #e8e8e8; margin: 0; font-size: 1.5rem;">
                                        ‚öôÔ∏è Configurar Servicio</h2>
                                    <button onclick="closeServiceConfigModal()"
                                        style="background: rgba(244, 67, 54, 0.3); border: 1px solid rgba(244, 67, 54, 0.5); color: #f44336; border-radius: 5px; padding: 8px 16px; cursor: pointer; font-size: 1.2rem; line-height: 1;">
                                        ‚úï
                                    </button>
                                </div>
                                <form id="service-config-form" onsubmit="saveServiceConfig(event)">
                                    <div id="service-config-content">
                                        <!-- Contenido se carga din√°micamente -->
                                    </div>
                                    <div id="service-config-message"
                                        style="display: none; padding: 12px; border-radius: 8px; margin: 15px 0; font-size: 0.9rem;">
                                    </div>
                                    <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                                        <button type="button" onclick="closeServiceConfigModal()"
                                            style="padding: 12px 24px; background: rgba(102, 126, 234, 0.2); border: 1px solid rgba(102, 126, 234, 0.5); color: #667eea; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                            Cancelar
                                        </button>
                                        <button type="submit"
                                            style="padding: 12px 24px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; color: white; border-radius: 8px; cursor: pointer; font-weight: 600;">
                                            üíæ Guardar Configuraci√≥n
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <!-- Agente de Redes Sociales -->
                        <div class="category-section" style="margin-top: 10px; margin-bottom: 10px;">
                            <h2 class="category-title"
                                style="color: #e8e8e8; font-size: 1.1rem; margin-bottom: 8px; text-align: center; padding: 8px 12px; background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%); border-radius: 8px; border: 2px solid rgba(102, 126, 234, 0.3);">
                                ü§ñ Agente de Redes Sociales</h2>
                            <div class="tools-grid"
                                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 8px;">
                                <a href="{{ url_for('routes.admin_social_media') }}" class="tool-card"
                                    style="border-color: rgba(102, 126, 234, 0.3); background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(102, 126, 234, 0.05) 100%); padding: 12px; border-radius: 8px; text-decoration: none; color: inherit; transition: all 0.3s ease; border: 2px solid rgba(102, 126, 234, 0.3);">
                                    <span
                                        style="display: inline-block; background: rgba(102, 126, 234, 0.3); color: #667eea; padding: 3px 8px; border-radius: 15px; font-size: 0.7rem; font-weight: bold; margin-bottom: 5px;">1.1</span>
                                    <span class="icon"
                                        style="font-size: 1.8rem; display: block; margin-bottom: 5px;">üí¨</span>
                                    <h3 style="color: #fff; margin: 5px 0; font-size: 1rem;">Gesti√≥n del Agente</h3>
                                    <p style="color: #aaa; margin: 5px 0; font-size: 0.8rem;">Gestiona el agente virtual
                                        que responde mensajes en redes sociales usando OpenAI</p>
                                    <span class="badge"
                                        style="background: rgba(102, 126, 234, 0.2); color: #667eea; padding: 3px 8px; border-radius: 12px; font-size: 0.7rem; display: inline-block; margin-top: 5px;">IA</span>
                                </a>
                            </div>
                        </div>

                        <!-- Seguridad y Configuraci√≥n -->
                        <div class="category-section" style="margin-bottom: 10px;">
                            <h2 class="category-title"
                                style="color: #e8e8e8; font-size: 1.1rem; margin-bottom: 8px; text-align: center; padding: 8px 12px; background: linear-gradient(135deg, rgba(244, 67, 54, 0.2) 0%, rgba(244, 67, 54, 0.1) 100%); border-radius: 8px; border: 2px solid rgba(244, 67, 54, 0.3);">
                                üîí Seguridad y Configuraci√≥n</h2>
                            <div class="tools-grid"
                                style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                                <a href="{{ url_for('routes.fraud_config') }}" class="tool-card security"
                                    style="background: linear-gradient(135deg, rgba(244, 67, 54, 0.1) 0%, rgba(244, 67, 54, 0.05) 100%); padding: 25px; border-radius: 15px; text-decoration: none; color: inherit; transition: all 0.3s ease; border: 2px solid rgba(244, 67, 54, 0.3);">
                                    <span
                                        style="display: inline-block; background: rgba(244, 67, 54, 0.3); color: #f44336; padding: 4px 10px; border-radius: 20px; font-size: 0.85rem; font-weight: bold; margin-bottom: 10px;">2.1</span>
                                    <span class="icon"
                                        style="font-size: 2.5rem; display: block; margin-bottom: 10px;">üõ°Ô∏è</span>
                                    <h3 style="color: #fff; margin: 10px 0; font-size: 1.3rem;">Configuraci√≥n
                                        Anti-Fraude</h3>
                                    <p style="color: #aaa; margin: 10px 0;">Ajusta los par√°metros de detecci√≥n de
                                        fraudes en entregas</p>
                                </a>

                                <a href="{{ url_for('routes.fraud_history') }}" class="tool-card security"
                                    style="background: linear-gradient(135deg, rgba(244, 67, 54, 0.1) 0%, rgba(244, 67, 54, 0.05) 100%); padding: 25px; border-radius: 15px; text-decoration: none; color: inherit; transition: all 0.3s ease; border: 2px solid rgba(244, 67, 54, 0.3);">
                                    <span
                                        style="display: inline-block; background: rgba(244, 67, 54, 0.3); color: #f44336; padding: 4px 10px; border-radius: 20px; font-size: 0.85rem; font-weight: bold; margin-bottom: 10px;">2.2</span>
                                    <span class="icon"
                                        style="font-size: 2.5rem; display: block; margin-bottom: 10px;">‚ö†Ô∏è</span>
                                    <h3 style="color: #fff; margin: 10px 0; font-size: 1.3rem;">Historial de Fraudes
                                    </h3>
                                    <p style="color: #aaa; margin: 10px 0;">Revisa todos los intentos de fraude
                                        detectados y autorizados</p>
                                </a>

                                <form action="{{ url_for('routes.restart_service') }}" method="POST"
                                    style="margin: 0; display: block;" id="restart-form">
                                    <button type="submit" class="tool-card security"
                                        style="border: 2px solid rgba(244, 67, 54, 0.3); width: 100%; cursor: pointer; background: linear-gradient(135deg, rgba(244, 67, 54, 0.1) 0%, rgba(244, 67, 54, 0.05) 100%); text-align: left; padding: 25px; transition: all 0.3s ease; font-family: inherit; text-decoration: none; color: inherit; border-radius: 15px;">
                                        <span
                                            style="display: inline-block; background: rgba(244, 67, 54, 0.3); color: #f44336; padding: 4px 10px; border-radius: 20px; font-size: 0.85rem; font-weight: bold; margin-bottom: 10px;">2.3</span>
                                        <span class="icon"
                                            style="font-size: 2.5rem; display: block; margin-bottom: 10px;">üîÑ</span>
                                        <h3 style="color: #fff; margin: 10px 0; font-size: 1.3rem;">Reiniciar Servicio
                                        </h3>
                                        <p style="color: #aaa; margin: 10px 0;">Reinicia el servidor Flask para aplicar
                                            cambios y configuraciones</p>
                                        <span class="badge"
                                            style="background: rgba(244, 67, 54, 0.2); color: #f44336; padding: 5px 12px; border-radius: 15px; font-size: 0.85rem; display: inline-block; margin-top: 10px;">Reinicio
                                            Seguro</span>
                                    </button>
                                </form>
                            </div>
                        </div>

                        <!-- Reinicio Total del Sistema - Al Final -->
                        <div
                            style="margin-top: 10px; padding: 15px; text-align: center; background: rgba(26, 26, 46, 0.5); border: 2px solid rgba(255, 87, 34, 0.3); border-radius: 8px;">
                            <h3 style="color: #e8e8e8; margin: 0 0 8px 0; font-size: 1rem;">‚ö° Reinicio Total del Sistema
                            </h3>
                            <p style="color: #aaa; margin: 0 0 10px 0; font-size: 0.75rem;">
                                Esta acci√≥n reiniciar√° todos los servicios, limpiar√° cach√©s y recargar√° la configuraci√≥n
                                del sistema.
                            </p>
                            <button onclick="restartEverything()" id="restart-everything-btn" style="padding: 10px 25px; background: linear-gradient(135deg, #ff5722 0%, #f44336 100%); 
                   border: none; color: white; border-radius: 8px; cursor: pointer; 
                   font-size: 0.9rem; font-weight: 600; transition: all 0.3s ease;
                   box-shadow: 0 3px 10px rgba(255, 87, 34, 0.4);"
                                onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 5px 15px rgba(255, 87, 34, 0.6)'"
                                onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 3px 10px rgba(255, 87, 34, 0.4)'">
                                ‚ö° Reinicio Total del Sistema
                            </button>
                            <div id="restart-everything-message"
                                style="display: none; margin-top: 10px; padding: 10px; border-radius: 6px; font-size: 0.85rem;">
                            </div>
                        </div>

                        {% endblock %}